"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8462],{3905:(e,t,n)=>{n.r(t),n.d(t,{MDXContext:()=>s,MDXProvider:()=>u,mdx:()=>f,useMDXComponents:()=>m,withMDXComponents:()=>p});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(){return o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},o.apply(this,arguments)}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),p=function(e){return function(t){var n=m(t.components);return a.createElement(e,o({},t,{components:n}))}},m=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=m(e.components);return a.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,r=e.parentName,s=d(e,["components","mdxType","originalType","parentName"]),p=m(n),u=i,h=p["".concat(r,".").concat(u)]||p[u]||c[u]||o;return n?a.createElement(h,l(l({ref:t},s),{},{components:n})):a.createElement(h,l({ref:t},s))}));function f(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=h;var l={};for(var d in t)hasOwnProperty.call(t,d)&&(l[d]=t[d]);l.originalType=e,l.mdxType="string"==typeof e?e:i,r[1]=l;for(var s=2;s<o;s++)r[s]=n[s];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},3850:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>d,default:()=>c,frontMatter:()=>l,metadata:()=>s,toc:()=>m});var a=n(83117),i=n(80102),o=(n(67294),n(3905)),r=["components"],l={id:"supporting-layout",title:"Implementing Layout Inspection"},d=void 0,s={unversionedId:"extending/supporting-layout",id:"extending/supporting-layout",title:"Implementing Layout Inspection",description:"To enable the Flipper Layout Inspector on a new platform, just implement a client plugin with id Inspector that implements the interface detailed in this page.",source:"@site/../docs/extending/supporting-layout.mdx",sourceDirName:"extending",slug:"/extending/supporting-layout",permalink:"/docs/extending/supporting-layout",draft:!1,editUrl:"https://github.com/facebook/flipper/blob/main/website/../docs/extending/supporting-layout.mdx",tags:[],version:"current",frontMatter:{id:"supporting-layout",title:"Implementing Layout Inspection"},sidebar:"main",previous:{title:"Secure Communication",permalink:"/docs/extending/establishing-a-connection"},next:{title:"Crash Reporter",permalink:"/docs/setup/plugins/crash-reporter"}},p={},m=[{value:"Node",id:"node",level:2},{value:"Node Parameters",id:"node-parameters",level:3},{value:"Plugin Interface",id:"plugin-interface",level:2},{value:"Interface methods",id:"interface-methods",level:3}],u={toc:m};function c(e){var t=e.components,n=(0,i.Z)(e,r);return(0,o.mdx)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.mdx)("p",null,"To enable the Flipper Layout Inspector on a new platform, just implement a client plugin with id ",(0,o.mdx)("inlineCode",{parentName:"p"},"Inspector")," that implements the interface detailed in this page."),(0,o.mdx)("admonition",{type:"note"},(0,o.mdx)("p",{parentName:"admonition"},"The ",(0,o.mdx)("a",{parentName:"p",href:"https://flow.org/en/docs/types/objects/"},"Flow")," syntax is used to specify this JSON API.")),(0,o.mdx)("h2",{id:"node"},"Node"),(0,o.mdx)("p",null,"Node is the core data type of the layout inspector. The Flipper desktop plugin visualizes a tree of nodes with associated data and attributes. Any UI or data model which can be modeled as a tree of nodes can be inspected using the layout inspector. Data associated with the nodes can also be edited."),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-ts"},"type NodeId = string;\n\ntype InspectorValue = {\n  __type__: 'auto' | 'text' | 'number' | 'boolean' | 'enum' | 'color',\n  __mutable__: boolean,\n  value: number | string | boolean,\n};\n\ntype Node = {\n  id: NodeId,\n  name: string,\n  data: ?{string: Object},\n  children: Array<NodeId>,\n  attributes: ?Array<{name: string, value: string}>,\n  decoration: ?string,\n};\n")),(0,o.mdx)("h3",{id:"node-parameters"},"Node Parameters"),(0,o.mdx)("p",null,"Following is a description of the parameters used in the above node:"),(0,o.mdx)("ul",null,(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("inlineCode",{parentName:"li"},"id")," - a stable, globally unique, node identifier."),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("inlineCode",{parentName:"li"},"name")," - the user-facing identifier for this node. It does not need to be unique. Typically, the class name of the node is used as the node's name."),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("inlineCode",{parentName:"li"},"data")," - a set of named JSON objects representing data associated with the node. This 'data' is rendered as immutable, by default, to the user of the plugin but can be made mutable by wrapping any value in a 'InspectorValue' with the ",(0,o.mdx)("inlineCode",{parentName:"li"},"__mutable__")," attribute set to true.",(0,o.mdx)("ul",{parentName:"li"},(0,o.mdx)("li",{parentName:"ul"},"The 'InspectorValue' can also be used to change the parsed type of the value, such as parsing a number as a color to show the value in a color picker."))),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("inlineCode",{parentName:"li"},"children")," - a list of identifiers pointing to children of this node. This is a list of identifiers instead of a list of nodes to allow nodes to be lazily fetched and instantiated."),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("inlineCode",{parentName:"li"},"attributes"),"- a list of key-value pairs, which are displayed alongside the name in the Layout Inspector."),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("inlineCode",{parentName:"li"},"decoration")," - a string identifying the optional icon used to decorate a node in the Layout Inspector. Adding new decoration options requires adding an icon file to the Sonar desktop app. Currently, ComponentKit and Litho decorations are supported.")),(0,o.mdx)("h2",{id:"plugin-interface"},"Plugin Interface"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-ts"},"interface ClientLayoutPlugin {\n  Node getRoot();\n  GetNodesResponse getNodes({ids: Array<NodeId>});\n  GetAllNodesResponse getAllNodes();\n  void setData({id: NodeId, path: Array<string>, value: any});\n  void setHighlighted({id: ?NodeId});\n  void setSearchActive({active: boolean});\n  GetSearchResultsResponse getSearchResults({query: string});\n};\n\ninterface DesktopLayoutPlugin {\n  void invalidate({id: NodeId});\n  void select({path: Array<NodeId>});\n};\n\ntype GetNodesResponse = {\n  elements: Array<Node>\n};\ntype GetAllNodesResponse = {\n  elements: Array<Node>,\n  rootElement: NodeId\n};\ntype GetSearchResultsResponse = {\n  results: ?SearchResultNode,\n  query: string\n};\n\ntype SearchResultNode = {\n  id: NodeId,\n  isMatch: boolean,\n  element: Node,\n  children: ?Array<SearchResultNode>\n}\ntype NodeId = string;\n")),(0,o.mdx)("h3",{id:"interface-methods"},"Interface methods"),(0,o.mdx)("ul",null,(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("inlineCode",{parentName:"li"},"getRoot")," - returns the root node of your hierarchy. This is the entry point of Flipper's traversal of your layout."),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("inlineCode",{parentName:"li"},"getNodes")," - maps a set of Node Ids to their corresponding nodes. This call is used to, among other things, query the children of a node."),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("inlineCode",{parentName:"li"},"getAllNodes")," - similar to 'getNodes', this should return all nodes in the current layout tree. Ordinarily, nodes are requested lazily, however this exists for taking snapshots of the current state."),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("inlineCode",{parentName:"li"},"setData")," - set the data of an mutable data object returned as part of the data field of a node:",(0,o.mdx)("ul",{parentName:"li"},(0,o.mdx)("li",{parentName:"ul"},"The ",(0,o.mdx)("inlineCode",{parentName:"li"},"id")," parameter identifies the node."),(0,o.mdx)("li",{parentName:"ul"},"The ",(0,o.mdx)("inlineCode",{parentName:"li"},"path")," parameter is an index path into an object, such as ",(0,o.mdx)("inlineCode",{parentName:"li"},"['bounds', 'left']"),"."),(0,o.mdx)("li",{parentName:"ul"},"The ",(0,o.mdx)("inlineCode",{parentName:"li"},"value")," parameter is a value of appropriate type to be used as an override."))),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("inlineCode",{parentName:"li"},"setHighlighted")," - marks a node as highlighted. It is expected that implementations add a colored overlay to the node identified by id on screen, so that as the user browses the layout tree in Flipper, they can easily see on the client display the nodes with which they are interacting. Passing a null id parameter removes the current highlight without highlighting a new node."),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("inlineCode",{parentName:"li"},"setSearchActive")," - the user has clicked on the crosshair button in Sonar. This feature allows the user to click on an element in the client UI to cause Flipper to highlight the corresponding node in the layout tree. A colored overlay should be shown over the whole screen until ",(0,o.mdx)("inlineCode",{parentName:"li"},"setSearchActive")," is called with ",(0,o.mdx)("inlineCode",{parentName:"li"},"active: false"),". While ",(0,o.mdx)("inlineCode",{parentName:"li"},"setSearchActive")," is true. Clicking an element in the client UI should trigger a ",(0,o.mdx)("inlineCode",{parentName:"li"},"select")," call to the Flipper desktop, with the path of ids from root to selected node, for example, ",(0,o.mdx)("inlineCode",{parentName:"li"},"select(['node1', 'node6', 'node65'])")," to select a grandchild of ",(0,o.mdx)("inlineCode",{parentName:"li"},"node1"),"."),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("inlineCode",{parentName:"li"},"getSearchResults")," - executes a query on all nodes in the tree and returns a subtree of the layout tree that contains all matching nodes and those on the path from root. A parent that does not itself match the query but exists on the path to a node that does, should have the attribute ",(0,o.mdx)("inlineCode",{parentName:"li"},"isMatch: false")," and only the matching nodes should have ",(0,o.mdx)("inlineCode",{parentName:"li"},"isMatch: true"),". Nodes not on the path from root to a match need not be included in the returned tree. Be careful not to confuse this method with the unrelated ",(0,o.mdx)("inlineCode",{parentName:"li"},"setSearchActive"),", which unfortunately shares a similar name.")),(0,o.mdx)("admonition",{type:"note"},(0,o.mdx)("p",{parentName:"admonition"},"Whenever a node or subtree changes, it is expected that the client sends a ",(0,o.mdx)("inlineCode",{parentName:"p"},"invalidate")," command to the desktop app over the active connection. This invalidates the cache of the subtree anchored by the node with the given id.")))}c.isMDXComponent=!0}}]);
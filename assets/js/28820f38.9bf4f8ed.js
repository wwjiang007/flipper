"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7001],{3905:(e,t,n)=>{n.r(t),n.d(t,{MDXContext:()=>s,MDXProvider:()=>u,mdx:()=>g,useMDXComponents:()=>d,withMDXComponents:()=>c});var i=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(){return a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},a.apply(this,arguments)}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=i.createContext({}),c=function(e){return function(t){var n=d(t.components);return i.createElement(e,a({},t,{components:n}))}},d=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=d(e.components);return i.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},f=i.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,o=e.parentName,s=p(e,["components","mdxType","originalType","parentName"]),c=d(n),u=r,f=c["".concat(o,".").concat(u)]||c[u]||m[u]||a;return n?i.createElement(f,l(l({ref:t},s),{},{components:n})):i.createElement(f,l({ref:t},s))}));function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,o=new Array(a);o[0]=f;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var s=2;s<a;s++)o[s]=n[s];return i.createElement.apply(null,o)}return i.createElement.apply(null,n)}f.displayName="MDXCreateElement"},18779:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>c,default:()=>g,frontMatter:()=>s,metadata:()=>d,toc:()=>m});var i=n(83117),r=n(80102),a=(n(67294),n(3905)),o=n(44996),l=n(39960),p=["components"],s={id:"javascript",title:"Building a JavaScript (Browser) Plugin"},c=void 0,d={unversionedId:"tutorial/javascript",id:"tutorial/javascript",title:"Building a JavaScript (Browser) Plugin",description:"This tutorial requires a browser that supports WebSockets.",source:"@site/../docs/tutorial/javascript.mdx",sourceDirName:"tutorial",slug:"/tutorial/javascript",permalink:"/docs/tutorial/javascript",draft:!1,editUrl:"https://github.com/facebook/flipper/blob/main/website/../docs/tutorial/javascript.mdx",tags:[],version:"current",frontMatter:{id:"javascript",title:"Building a JavaScript (Browser) Plugin"},sidebar:"main",previous:{title:"Building a React Native Plugin",permalink:"/docs/tutorial/react-native"},next:{title:"Setup",permalink:"/docs/tutorial/js-setup"}},u={},m=[{value:"Step 1 - install Flipper JavaScript SDK",id:"step-1---install-flipper-javascript-sdk",level:2},{value:"Step 2 - start the Flipper client",id:"step-2---start-the-flipper-client",level:2},{value:"Step 3 - call <code>addPlugin</code> to add your plugin",id:"step-3---call-addplugin-to-add-your-plugin",level:2},{value:"Live demo",id:"live-demo",level:2}],f={toc:m};function g(e){var t=e.components,n=(0,r.Z)(e,p);return(0,a.mdx)("wrapper",(0,i.Z)({},f,n,{components:t,mdxType:"MDXLayout"}),(0,a.mdx)("admonition",{type:"caution"},(0,a.mdx)("p",{parentName:"admonition"},"This tutorial requires a browser that supports ",(0,a.mdx)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/WebSocket"},"WebSockets"),".")),(0,a.mdx)("p",null,"This section of the tutorial goes through the three steps required to build a JavaScript plugin."),(0,a.mdx)("h2",{id:"step-1---install-flipper-javascript-sdk"},"Step 1 - install Flipper JavaScript SDK"),(0,a.mdx)("p",null,"Add the Flipper client to your web application. Run ",(0,a.mdx)("inlineCode",{parentName:"p"},"npm install js-flipper")," (",(0,a.mdx)("inlineCode",{parentName:"p"},"yarn add js-flipper"),")"),(0,a.mdx)("h2",{id:"step-2---start-the-flipper-client"},"Step 2 - start the Flipper client"),(0,a.mdx)("admonition",{type:"warning"},(0,a.mdx)("p",{parentName:"admonition"},"Do not start the Flipper client in production! Preferably, do not even include Flipper in your production builds!")),(0,a.mdx)("p",null,"Use the following to start the Flipper client:"),(0,a.mdx)("pre",null,(0,a.mdx)("code",{parentName:"pre",className:"language-tsx",metastring:"file=js/react-flipper-example/src/FlipperTicTacToe.tsx start=DOCS_START_CLIENT_START end=DOCS_START_CLIENT_END",file:"js/react-flipper-example/src/FlipperTicTacToe.tsx",start:"DOCS_START_CLIENT_START",end:"DOCS_START_CLIENT_END"},"// We want to import and start flipper client only in development and test modes\nlet flipperClientPromise: Promise<FlipperClient> | undefined;\nif (process.env.NODE_ENV !== 'production') {\n  flipperClientPromise = import('js-flipper').then(({flipperClient}) => {\n    flipperClient.start('React Tic-Tac-Toe');\n    return flipperClient;\n  });\n}\n")),(0,a.mdx)("h2",{id:"step-3---call-addplugin-to-add-your-plugin"},"Step 3 - call ",(0,a.mdx)("inlineCode",{parentName:"h2"},"addPlugin")," to add your plugin"),(0,a.mdx)("p",null,"To register a new plugin with Flipper, call ",(0,a.mdx)("inlineCode",{parentName:"p"},"flipperClient.addPlugin")," and pass your plugin as an object."),(0,a.mdx)("p",null,"Your plugin must conform to the following interface:"),(0,a.mdx)("pre",null,(0,a.mdx)("code",{parentName:"pre",className:"language-ts",metastring:"file=js/js-flipper/src/plugin.ts start=DOCS_FLIPPER_PLUGIN_START end=DOCS_FLIPPER_PLUGIN_END",file:"js/js-flipper/src/plugin.ts",start:"DOCS_FLIPPER_PLUGIN_START",end:"DOCS_FLIPPER_PLUGIN_END"},"export interface FlipperPlugin {\n  /**\n   * @return The id of this plugin. This is the namespace which Flipper desktop plugins will call\n   *     methods on to route them to your plugin. This should match the id specified in your React\n   *     plugin.\n   */\n  getId(): string;\n\n  /**\n   * Called when a connection has been established. The connection passed to this method is valid\n   * until {@link FlipperPlugin#onDisconnect()} is called.\n   */\n  onConnect(connection: FlipperPluginConnection): void;\n\n  /**\n   * Called when the connection passed to `FlipperPlugin#onConnect(FlipperConnection)` is no\n   * longer valid. Do not try to use the connection in or after this method has been called.\n   */\n  onDisconnect(): void;\n\n  /**\n   * Returns true if the plugin is meant to be run in background too, otherwise it returns false.\n   */\n  runInBackground?(): boolean;\n}\n")),(0,a.mdx)("p",null,"The ",(0,a.mdx)("inlineCode",{parentName:"p"},"onConnect")," and ",(0,a.mdx)("inlineCode",{parentName:"p"},"onDisconnect")," events, featured in the above snippet, are triggered every time the plugin becomes (in)active in the Flipper desktop application.\nIf the plugin is a ",(0,a.mdx)(l.default,{to:(0,o.default)("/docs/extending/create-plugin#background-plugins"),mdxType:"Link"},"background plugin"),", these events are triggered typically only once (they might be triggered never if the Desktop user didn't enable the plugin, or multiple times if they enabled or disabled the plugin a few times)."),(0,a.mdx)("p",null,"The ",(0,a.mdx)("inlineCode",{parentName:"p"},"onConnect")," callback receive a ",(0,a.mdx)("inlineCode",{parentName:"p"},"connection")," which can be used to communicate with the backend:"),(0,a.mdx)("pre",null,(0,a.mdx)("code",{parentName:"pre",className:"language-tsx",metastring:"file=js/react-flipper-example/src/FlipperTicTacToe.tsx start=DOCS_ADD_PLUGIN_START end=DOCS_ADD_PLUGIN_END",file:"js/react-flipper-example/src/FlipperTicTacToe.tsx",start:"DOCS_ADD_PLUGIN_START",end:"DOCS_ADD_PLUGIN_END"},"// TicTacToe game status\nconst [status, setStatus] = useState('Waiting for Flipper Desktop Player...');\n// TicTacToe game state\nconst [gameState, setGameState] = useState<GameState>({\n  cells: [],\n  turn: ' ',\n  winner: ' ',\n});\n// Flipper connection instance\nconst [connection, setConnection] = useState<FlipperPluginConnection>();\n\nuseEffect(() => {\n  flipperClientPromise?.then(flipperClient => {\n    flipperClient.addPlugin({\n      getId() {\n        // Name of the plugin\n        return 'ReactNativeTicTacToe';\n      },\n      onConnect(connection) {\n        // Once we connected, we display it to the user\n        setStatus('Desktop player present');\n        // And stash the connection object\n        setConnection(connection);\n\n        // We start listening to updates from Flipper Desktop\n        connection.receive('SetState', (gameState: GameState) => {\n          if (gameState.winner !== ' ') {\n            setStatus(\n              `Winner is ${gameState.winner}! Waiting for a new game...`,\n            );\n          } else {\n            setStatus(\n              gameState.turn === 'X'\n                ? 'Your turn...'\n                : 'Awaiting desktop players turn...',\n            );\n          }\n          setGameState(gameState);\n        });\n\n        // We also request the initial state of the game from Flipper Desktop\n        connection.send('GetState');\n      },\n      onDisconnect() {\n        // When Flipper Desktop disconnects, we show it to the user\n        setConnection(undefined);\n        setStatus('Desktop player gone...');\n      },\n    });\n  });\n}, []);\n")),(0,a.mdx)("p",null,"You might want to store the connection somewhere to be able to send more events as long as ",(0,a.mdx)("inlineCode",{parentName:"p"},"onDisconnect")," event hasn't been fired."),(0,a.mdx)("p",null,"The ",(0,a.mdx)("inlineCode",{parentName:"p"},"connection")," object can also be used to listen to messages coming from the Desktop plugin. See ",(0,a.mdx)(l.default,{to:(0,o.default)("/docs/extending/create-plugin"),mdxType:"Link"},"Client Plugin API")," for details."),(0,a.mdx)("h2",{id:"live-demo"},"Live demo"),(0,a.mdx)("p",null,"An example plugin to play a little Tic-Tac-Toe between the Flipper Desktop and a React app can be found inside this repository as well (run ",(0,a.mdx)("inlineCode",{parentName:"p"},"yarn && yarn start")," in ",(0,a.mdx)("inlineCode",{parentName:"p"},"js/react-flipper-example")," to start the test project):"),(0,a.mdx)("ul",null,(0,a.mdx)("li",{parentName:"ul"},"The React plugin implementation - ",(0,a.mdx)("a",{parentName:"li",href:"https://github.com/facebook/flipper/tree/main/js/react-flipper-example/src/FlipperTicTacToe.tsx"},"FlipperTicTacToe.tsx")),(0,a.mdx)("li",{parentName:"ul"},"The Flipper Desktop plugin implementation - ",(0,a.mdx)("a",{parentName:"li",href:"https://github.com/facebook/flipper/blob/main/desktop/plugins/public/rn-tic-tac-toe/index.tsx"},"rn-tic-tac-toe/index.tsx"))))}g.isMDXComponent=!0}}]);